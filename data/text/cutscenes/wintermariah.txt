// SETUP

#include intrographics.txt
#include ladyluckbiggraphics.txt

setdatapath("data/animations/mariahcarey/");

var mariahhumangraphics	= {
  	idle: {
		sprites: ["mariahcarey.png"]
	}
}
var mariahhuman = addsprite("mariahhuman", 1, mariahhumangraphics);

setdatapath("data/graphics/cutscenes/mariah/");
var mariahgraphics = {
	idle: {
		animation: "mariah_idle.json",
		pack: "mariah.pck",
		loop: true
	},
	worried_idle: {
		animation: "mariah_worried_idle.json",
		pack: "mariah.pck",
		loop: true
	},
	transform: {
		animation: "mariah_transform.json",
		pack: "mariah.pck",
		speed: 2,
		loop: false
	}
}
var mariah = addsprite("mariah", 1, mariahgraphics);

// HELPER FUNCTIONS	

function signanimate(sign) {
	var s = sign.show("turn");
	//s.onComplete(function() { resume(); sign.show("loop"); });
	//pause();
	while(!s.completed) {
		// do nothing
	}
	sign.show("loop");
}

function fadein_sprite(sprite, time) {
	return;
	sprite.alpha = 0.0;
	Actuate.tween(sprite, time, { alpha: 1.0 });
	wait(time);
}

function fadeout_sprite(sprite, time) {
	return;
	Actuate.tween(sprite, time, { alpha: 0.0 });
	wait(time);
}

var fade_time = 0.4;

// ACTORS
actor("Lady Luck", screenwidthmid + 800, 550, Col.YELLOW, CENTER, BOTTOM, "chat_ladyluck", "characters/misc/charicon_ladyluck");
actor("Mariah", 2600, 600, Col.multiplylightness(Col.GREEN, 1.25), RIGHT, TOP, "chat_mariahcarey", "characters/misc/charicon_mariahcarey");
// INTRO

//play("music_cutscene_cheery");
play("music_cutscene_dark");

changebackground("intro_sign");

sign.y = -screenheight;
ladyluck_sign.y = -screenheight;
sign.show("loop");
ladyluck_sign.show("scary_idle");

Actuate.tween(sign, 2, { y: 0 }).ease(Expo.easeOut);
Actuate.tween(ladyluck_sign, 2, { y: 0 }).ease(Expo.easeOut);

wait(0.5);

fadein();
play("cutscene_audience");

wait(1.5);

ladyluck_sign.show("scary_talking", true);
speak("Lady Luck", "... You.", "angry");
speak("Lady Luck", "Did you really think turning me into a|dice would let you be a permanent host?", "angry");
ladyluck_sign.show("scary_idle", true);

fadeout();
while(isfading()) {
	// do nothing
}

sign.hide();
ladyluck_sign.hide();

mariahhuman.x = 2270 - ((mariahhuman.getwidth("idle") * mariahhuman.scale) * 3 / 4);
mariahhuman.y = 700;
changebackground("intro_stage");
fadein();
mariahhuman.show("idle");

ladyluck_big.x = -screenwidth;
ladyluck_big.show("idle-scary");
Actuate.tween(ladyluck_big, 2, { x: 0 }).ease(Expo.easeOut);

actor("Mariah", 2620 - 350, 200, Col.multiplylightness(Col.RED, 1.25), RIGHT, TOP, "chat_mariahcarey", "characters/misc/charicon_mariahcarey");
speak("Mariah", "Kinda didn't plan ahead, to be honest.", "normal");
speak("Mariah", "I thought it would be a fun twist!");

ladyluck_big.show("talking-scary", true);
actor("Lady Luck", screenwidthmid + 240, screenheightmid - 240, Col.YELLOW, RIGHT, BOTTOM, "chat_ladyluck", "characters/misc/charicon_ladyluck");
speak("Lady Luck", "Well, too bad, beacuse now it's your turn.", "scary");
ladyluck_big.show("idle-scary", true);

speak("Mariah", "Wait, you don't have to do this!", "normal");
speak("Mariah", "What'll happen to my body?|What if fans stop watching me?!");

ladyluck_big.show("talking-confused", true);
actor("Lady Luck", screenwidthmid + 240, screenheightmid - 240, Col.YELLOW, RIGHT, BOTTOM, "chat_ladyluck", "characters/misc/charicon_ladyluck");
speak("Lady Luck", "Then they probably weren't watching for your music, anyway.", "sly");
ladyluck_big.show("idle-confused", true);

fadeout();
while(isfading()) {
	// do nothing
}
changebackground("intro_transform");
ladyluck_big.hide();
mariahhuman.hide();
fadein();

mariah.x = screenwidth;
var transform = mariah.show("transform");
Actuate.tween(mariah, 2, { x: 0 }).ease(Expo.easeOut);

var marker_human = false;
var marker_dice = false;
while(true) {	
	if(!marker_human && transform.marker == "human") {
		marker_human = true;
		transform.paused = true;
    actor("Lady Luck", screenwidthmid + 800, 550, Col.YELLOW, CENTER, BOTTOM, "chat_ladyluck", "characters/misc/charicon_ladyluck");
    speak("Lady Luck", "Trust me, I'm sure you'll do fine.", "sly");
    play("transformintodice");
		transform.paused = false;
	} else if(!marker_dice && transform.marker == "dice") {
		marker_dice = true;
		transform.paused = true;
    actor("Lady Luck", screenwidthmid + 500, 550, Col.YELLOW, CENTER, BOTTOM, "chat_ladyluck", "characters/misc/charicon_ladyluck");
    speak("Lady Luck", "Plus: won't this be such a fun twist?!", "angry");
	  break;
	}
}


startgamefromcutscene();
