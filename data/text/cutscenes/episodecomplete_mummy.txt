// SETUP

#include endepisodegraphics_ladyluck.txt
#include ladyluckbiggraphics.txt

var episodeover = true;
#include getepisodenum.txt

var player = getplayername();
var mariahannouncing = player == "Lady Luck" || episodenum == 2;
var debugalwayswin = false;

var announcer = mariahannouncing ? mariah : ladyluck_sign;
var aname = mariahannouncing ? "Mariah Carey" : "Lady Luck";
// HELPER FUNCTIONS

function signanimate(sign) {
    var s = sign.show("turn");
    //s.onComplete(function() { resume(); sign.show("loop"); });
    //pause();
    while(!s.completed) {
        // do nothing
    }
    sign.show("loop");
}

function spinthewheel(sign, wheel, animation) {
  var s = sign.show("turn");
    //s.onComplete(function() { resume(); sign.show("loop"); });
    //pause();
    while(!s.completed) {
        // do nothing
    }
    sign.hide();

  wheel.x = 30;
  wheel.y = -30;
  play("spinthewheel");
    var s = wheel.show(animation);
    //s.onComplete(function() { resume(); sign.show("loop"); });
    //pause();
    while(!s.completed) {
        // do nothing
    }
    wheel.hide();
}

// ACTORS
if (mariahannouncing) {
	actor("Mariah Carey", screenwidthmid + 200, 100, Col.multiplylightness(Col.RED, 1.25), LEFT, TOP, "chat_mariahcarey", "characters/misc/charicon_mariahcarey");
} else {
	actor("Lady Luck", screenwidthmid + 200, 100, Col.YELLOW, LEFT, TOP, "chat_ladyluck", "characters/misc/charicon_ladyluck");
}
var spin = 70;
if (player == "Lady Luck" && episodenum == 2) {
	spin = 100;
}
if(player == "Warrior"){
  actor("Warrior", 150, screenheight - 100, Col.LIGHTBLUE, LEFT, BOTTOM, "chat_warrior", "characters/warrior/charicon_warrior");
  spin = 60;
}else if(player == "Thief"){
  actor("Thief", 150, screenheight - 100, Col.multiplylightness(Col.GREEN, 1.25), LEFT, BOTTOM, "chat_thief", "characters/thief/charicon_thief");
  spin = 60;
}else if(player == "Robot"){
  actor("Robot", 150, screenheight - 100, 0xDDDDDD, LEFT, BOTTOM, "chat_robot", "characters/robot/charicon_robot");
  spin = 60;
}else if(player == "Inventor"){
  actor("Inventor", 150, screenheight - 100, 0xffe48d, LEFT, BOTTOM, "chat_inventor", "characters/inventor/charicon_inventor");
  spin = 60;
}else if(player == "Witch"){
  actor("Witch", 150, screenheight - 100, 0xb496ec, LEFT, BOTTOM, "chat_witch", "characters/witch/charicon_witch");
  spin = 60;
}else if(player == "Jester"){
  actor("Jester", 150, screenheight - 100, Col.ORANGE, LEFT, BOTTOM, "chat_jester", "characters/jester/charicon_jester");
  spin = 60;
}else if(player == "Bear"){
  actor("Bear", 150, screenheight - 100, Col.RED, LEFT, BOTTOM, "chat_thief", "characters/bear/charicon_bear");
  spin = 70;
}else if(player == "Ghost of Present"){
  actor("Ghost of Present", 150, screenheight - 100, Col.RED, LEFT, BOTTOM, "chat_thief", "characters/thief/charicon_thief");
  spin = 100;
}else if(player == "Ghost of Past"){
  actor("Ghost of Past", 150, screenheight - 100, Col.RED, LEFT, BOTTOM, "chat_thief", "characters/thief/charicon_thief");
  spin = 100;
}else if(player == "Ghost of Future"){
  actor("Ghost of Future", 150, screenheight - 100, Col.RED, LEFT, BOTTOM, "chat_thief", "characters/thief/charicon_thief");
  spin = 100;
}else if(player == "Mariah"){
  actor("Mariah", 150, screenheight - 100, Col.RED, LEFT, BOTTOM, "chat_mariah", "characters/mariah/charicon_mariah");
  spin = 100;
}else{
  actor("Lady Luck", 150, screenheight - 100, Col.RED, LEFT, BOTTOM, "chat_ladyluck", "characters/lady luck/charicon_lady_luck");
}


// INTRO

play("music_cutscene_lesscheery");

changebackground("intro_sign");

sign.y = -screenheight;
announcer.y = -screenheight;
sign.show("loop");
announcer.show("idle");

Actuate.tween(sign, 2, { y: 0 }).ease(Expo.easeOut);
Actuate.tween(announcer, 2, { y: 0 }).ease(Expo.easeOut);

wait(0.5);

fadein();

wait(1.5);

announcer.show("talking");

if (player == "Lady Luck" && episodenum == 1) {
    speak("Mariah Carey", "Hey there, is it weird from your side?");
	announcer.show("idle");
    speak("Lady Luck", "Yes, a little bit. Are you going to spin the wheel or not?");
	announcer.show("talking");
	speak("Mariah Carey", "Just a minute, dear. Let me bask in this glory for a moment.");
	announcer.show("idle");
	wait(2);
	speak("Lady Luck", "Are you done yet?");
	announcer.show("talking");
	speak("Mariah Carey", "Sure.");
} else if (player == "Lady Luck" && episodenum == 2) {
	speak("Mariah Carey", "Oh, wow! You really managed to win fair and square.");
	speak("Mariah Carey", "Ready to spin that lovely, lovely wheel again?");
	announcer.show("idle");
	speak("Lady Luck", "Yeah, yeah... get on with it.");
	announcer.show("talking");
	speak("Mariah Carey", "Heh, you're no fun...");
} else {
    var firstlinevoice = false;
    for(message in variables.messages_beforespin) {
      var mood = "normal";
      if(!firstlinevoice){
        firstlinevoice = true;
        speak(aname, message.text, "normal");
      }else{
        speak(aname, message.text);
      }
    }
}

announcer.show("idle");

announcer.hide();
trace(spin);
var wheelwins = chance(spin) || debugalwayswin; // 50% chance to win
spinthewheel(sign, wheel, wheelwins ? "spin2" : "spin1");
trace(wheelwins);

signanimate(sign);

announcer.show("talking");

if (wheelwins) {
    play("stopallmusic");    
    play("cutscene_audience");
    play("music_cutscene_cheery");
    if (player == "Lady Luck" && episodenum == 1) {
        speak("Mariah Carey", "What the he- how did yo- wha?");
		announcer.show("idle");
		speak("Lady Luck", "Seems like just a matter of chance.");
		speak("Lady Luck", "I trust that you'll fulfill your end of the deal.");
		announcer.show("talking");
		speak("Mariah Carey", "Okay, fine.");
		
		fadeout();
		while(isfading()) {
			// do nothing
		}
		changebackground("intro_transform");
		announcer.hide();
		sign.hide();
		fadein();
		
		ladyluckdice.x = screenwidth;
		var transform = ladyluckdice.show("transform");
		Actuate.tween(ladyluckdice, 2, { x: 0 }).ease(Expo.easeOut);
		
		var marker_human = false;
		var marker_dice = false;
		while(true) {	
			if(!marker_human && transform.marker == "human") {
				marker_human = true;
				transform.paused = true;
		    play("transformintodice");
				transform.paused = false;
			} else if(!marker_dice && transform.marker == "dice") {
				marker_dice = true;
				transform.paused = true;
				speak("Lady Luck", "Tada!");
				break;
			}
		}
		
		fadeout();
		while(isfading()) {
			// do nothing
		}
		changebackground("after_transform");
		ladyluckdice.hide();
		fadein();
		ladyluck_big.x = -screenwidth;
		ladyluck_big.show("talking", true);
		Actuate.tween(ladyluck_big, 2, { x: 0 }).ease(Expo.easeOut);
		speak("Lady Luck", "What an adventure! That was really interesting!");
		speak("Lady Luck", "I'm so glad you all played this mod to its entirety.");
		speak("Lady Luck", "And if you skipped straight to me, please keep playing this mod.");
		ladyluck_big.show("talking-sly", true);
		speak("Lady Luck", "I know I'm great, but please look at everything in the mod.");
		ladyluck_big.show("talking", true);
		speak("Lady Luck", "Now... where were we?");
		speak("Lady Luck", "Oh, right! Mariah, how would you like to be a contestant?");
		
		play("stopallmusic");
		fadeout();
		while(isfading()) {
			// do nothing
		}
		ladyluck_big.hide();
		changebackground("nothing");
		fadein();
		play("_ladysnap");
		while(isfading()) {
			// do nothing
		}
		endingcredits();
		return;
	} else if (player == "Lady Luck" && episodenum == 2) {
		speak("Mariah Carey", "Haha, aww... I guess I have to turn you back, then...");
		speak("Mariah Carey", "...wait.");
		announcer.show("idle");
		speak("Lady Luck", "Wait?");
		announcer.show("talking");
		speak("Mariah Carey", "What was that equipment you were using earlier in the episode?");
		announcer.show("idle");
		speak("Lady Luck", "...where are you going with this.");
		announcer.show("talking");
		speak("Mariah Carey", "'Call for Backup Thief', wasn't it?");
		speak("Mariah Carey", "Oh dear, doesn't that count as... getting outside help?");
		announcer.show("idle");
		speak("Lady Luck", "You're kidding.");
		announcer.show("talking");
		speak("Mariah Carey", "Oh well. Back down into the dungeon for you!");
		announcer.show("idle");
		speak("Lady Luck", "Ha-ha.");
		announcer.hide();
		signanimate(sign);
		announcer = ladyluck_sign;
		announcer.show("talking");
		actor("Lady Luck_", screenwidthmid + 200, 100, Col.YELLOW, LEFT, TOP, "chat_ladyluck", "characters/misc/charicon_ladyluck");

		speak("Lady Luck_", "No, I don't think so.");
    } else {
		if (player == "Warrior" && episodenum == 1) {
			speak("Lady Luck", "Wow, it looks like it landed on the prize!", "normal");
			speak("Lady Luck", "What do you want, " + player + "?");
			announcer.show("idle");
			speak(player, "I want some candy!", "determined");
			announcer.show("talking");
			speak("Lady Luck", "Really? Candy?", "thinking");
			announcer.show("idle");
			speak(player, "Yep!", "normal");
			announcer.show("talking");
			speak("Lady Luck", "Even after we talked about how|there are much better things|to wish for?", "thinking");
			announcer.show("idle");
			speak(player, "Oh, true. Lemme think.", "worried");
			speak(player, "Yep!", "normal");
			announcer.show("talking");
			speak("Lady Luck", "Okay then...", "normal");
			announcer.show("idle");
		} else if (player == "Warrior" && episodenum == 2) {
			speak("Mariah Carey", "See, I knew you could do it!", "normal");
			announcer.show("idle");
			speak(player, "My head feels heavy... ugh.", "normal");
			speak(player, "Why did we have to do it like that?", "personality");
			speak(player, "I could've just bashed stuff.", "action");
			announcer.show("talking");
			speak("Mariah Carey", "Well, then you wouldn't have learned anything.", "normal");
			speak("Mariah Carey", "What did you learn?");
			announcer.show("idle");
			speak(player, "Hitting things works better than math!", "worried");
			announcer.show("talking");
			speak("Mariah Carey", "Haha... here's your candy.");
			announcer.show("idle");
			speak(player, "It wasn't even worth it...", "worried");
		} else if (player == "Thief" && episodenum == 1) {
			speak("Lady Luck", "Huh! It actually landed on the prize space.", "normal");
			announcer.show("idle");
			speak(player, "Gimme my money.", "determined");
			announcer.show("talking");
			speak("Lady Luck", "What, no awe-filled moment of reflection?");
			speak("Lady Luck", "Or perhaps reconsidering whether|you REALLY want all that money?", "sly");
			speak("Lady Luck", "After all, haven't you learned|a lesson from that episode?", "sly");
			announcer.show("idle");
			speak(player, "No, and I'm glad.", "personality");
			speak(player, "Now GIMME.", "determined");
			announcer.show("talking");
			speak("Lady Luck", "Alright, then.", "normal");
			speak("Lady Luck", "Bring out the wheelbarrow!", "personality");
			announcer.show("idle");
		} else if (player == "Thief" && episodenum == 2) {
			speak("Mariah Carey", "Oh, your idea worked!", "normal");
			announcer.show("idle");
			speak(player, "Is it that suprising?", "normal");
			speak(player, "You're not the only one with good ideas, you know?", "personality");
			announcer.show("talking");
			speak("Mariah Carey", "Hmph.", "normal");
			speak("Mariah Carey", "Well, here's your 1.3 million dollars...");
			announcer.show("idle");
			speak(player, "I wanted a billion!", "worried");
			announcer.show("talking");
			speak("Mariah Carey", "Right, but... America.");
			announcer.show("idle");
			speak(player, "Oh... ugh...", "worried");
		} else if (player == "Robot" && episodenum == 1) {
			speak("Lady Luck", "Well, would you look at that. Right on the prize.", "normal");
			announcer.show("idle");
			speak(player, "Wow.", "normal");
			speak(player, "Incredible.", "personality");
			announcer.show("talking");
			speak("Lady Luck", "Truly incredible.", "normal");
			speak("Lady Luck", "Enjoy your cyropod.|Not like you should need one.");
			speak("Lady Luck", "Don't you have a hibernate mode?", "thinking");
			announcer.show("idle");
			speak(player, "Probably, but you have no idea|how unintuitive biomechanical|operating systems are!", "worried");
			announcer.show("talking");
			speak("Lady Luck", "Fair enough.");
			announcer.show("idle");
		} else if (player == "Robot" && episodenum == 2) {
			speak("Mariah Carey", "Wow, this never gets old.", "normal");
			announcer.show("idle");
			speak(player, "What?", "normal");
			speak(player, "Being the new host?", "personality");
			announcer.show("talking");
			speak("Mariah Carey", "Exactly!", "normal");
			speak("Mariah Carey", "Enjoy your cyropod.|Not like you need one.");
			speak("Mariah Carey", "Didn't Lady Luck give you one already?", "thinking");
			announcer.show("idle");
			speak(player, "Funny thing, it broke down exactly yesterday.", "worried");
			speak(player, "Otherwise, I would have asked for something else.", "worried");
			announcer.show("talking");
			speak("Mariah Carey", "What a strange turn of completely coincidental events.");
			announcer.show("idle");
		} else if (player == "Inventor" && episodenum == 1) {
			speak("Lady Luck", "You did it! You actually won the wheel spin.", "normal");
			announcer.show("idle");
			speak(player, "That's fantastic!", "normal");
			announcer.show("talking");
			speak("Lady Luck", "Have fun with your infinite toolbox.", "sly");
			announcer.show("idle");
			speak(player, "Thanks!");
			speak(player, "...Wait, how is an endless toolbox|physically possible?", "thinking");
			announcer.show("talking");
			speak("Lady Luck", "How is standing on your spindly legs|physically possible?", "sly");
			announcer.show("idle");
			speak(player, "Point taken.");
		} else if (player == "Inventor" && episodenum == 2) {
			speak(player, "Woah, what a trip!", "normal");
			speak(player, "That was sooo cool!", "personality");
			announcer.show("talking");
			speak("Mariah Carey", "Aw thanks, I'm flattered!", "normal");
			speak("Mariah Carey", "Bet Lady Luck couldn't've thought of that.");
			announcer.show("idle");
			speak(player, "Probably not, that's why you're the best!", "worried");
			announcer.show("talking");
			speak("Mariah Carey", "Oh, stop it! Know what - as your gift,|I'll explain how it works!");
			announcer.show("idle");
			speak(player, "Wooooo!", "worried");
		} else if (player == "Witch" && episodenum == 2) {
			speak(player, "That was interesting...", "normal");
			speak(player, "Pretty sure Wizard hates me now.", "personality");
			announcer.show("talking");
			speak("Mariah Carey", "How come?", "normal");
			announcer.show("idle");
			speak(player, "He thinks I was mocking him.", "worried");
			announcer.show("talking");
			speak("Mariah Carey", "What a shame... Well, what would you like?");
			announcer.show("idle");
			speak(player, "Can you convince Wizard not to beat me up?", "worried");
			announcer.show("talking");
			speak("Mariah Carey", "Haha, I don't think even I can do that...");
			announcer.show("idle");
		} else if (player == "Witch" && episodenum == 1) {
			speak("Lady Luck", "You won the wheel spin. Huzzah.", "normal");
			speak("Lady Luck", "Magic is now literally real.");
			announcer.show("idle");
			speak(player, "This is so epic. Can we get 5,000 likes?", "personality");
			announcer.show("talking");
			speak("Lady Luck", "No.", "normal");
			announcer.show("idle");
		} else if (player == "Mariah" && episodenum == 1) {
			speak("Lady Luck", "Well... looks like you did it, despite|my best efforts. Good job.", "sly");
			speak("Lady Luck", "I guess you get to be human again.");
			announcer.show("idle");
			speak(player, "Oh, this is so lovely! I could just sing!", "personality");
			announcer.show("talking");
			speak("Lady Luck", "No....", "confused");
			speak("Lady Luck", "Don't.", "confused");
			announcer.show("idle");
		} else if (player == "Jester" && episodenum == 1) {
			speak("Lady Luck", "Congratulations, Jess. You won.", "normal");
			announcer.show("idle");
			speak(player, "So I did.", "determined");
			announcer.show("talking");
			speak("Lady Luck", "You know having EVERY item will break|pretty much everything, right?", "normal");
			announcer.show("idle");
			speak(player, "Exactly!");
			//speak(player, "I've always wanted to see the most|spectacular crash ever.");
			speak(player, "I've heard many a legend about the|\"Null Object Reference\", but now|I can finally see it for real.", "determined");
			announcer.show("talking");
			speak("Lady Luck", "Well, enjoy yourself.|Not right now, of course.", "normal");
			announcer.show("idle");
		} else if (player == "Jester" && episodenum == 2) {
			speak(player, "WHAT A RUSH!", "normal");
			speak(player, "WOOOOOOOO!", "personality");
			announcer.show("talking");
			speak("Mariah Carey", "I'm shocked the game didn't crash...", "normal");
			announcer.show("idle");
			speak(player, "I wish it did! That would be so cool!", "worried");
			announcer.show("talking");
			speak("Mariah Carey", "Well, what would you like now?");
			announcer.show("idle");
			speak(player, "For 2 of each Christmas item!", "worried");
			announcer.show("talking");
			speak("Mariah Carey", "You're... insane.");
			announcer.show("idle");
		} else if (player == "Bear" && episodenum == 1) {
			speak("Lady Luck", "Huh! It actually landed on the prize space.", "normal");
			announcer.show("idle");
			speak(player, "Rawrrarrawrrar");
			announcer.show("talking");
			speak("Lady Luck", "What?");
			speak("Lady Luck", "Oh dear it seems I can't understand you", "sly");
			speak("Lady Luck", "Guess you can't get a prize then", "sly");
			announcer.show("idle");
		} else if (player == "Ghost of Past" && episodenum == 1) {
			speak("Lady Luck", "Wait what's your name?", "normal");
			announcer.show("idle");
			speak(player, "Ghost of Christmas Past");
			announcer.show("talking");
			speak("Lady Luck", "Interesting");
			speak("Lady Luck", "Best not to ask questions I suppose", "sly");
			speak("Lady Luck", "What would you like to wish for?", "sly");
			announcer.show("idle");
			speak(player, "For this year to last forever!");
			announcer.show("talking");
			speak("Lady Luck", "You want 2021 to last forever?");
			announcer.show("idle");
			speak(player, "Oh darn your right, maybe some new tap shoes!");
			announcer.show("talking");
			speak("Lady Luck", "What a waste of my power....");
			announcer.show("idle");
		} else if (player == "Ghost of Present" && episodenum == 1) {
			speak("Lady Luck", "Wait what's your name?", "normal");
			announcer.show("idle");
			speak(player, "Ghost of Christmas Present");
			announcer.show("talking");
			speak("Lady Luck", "Interesting");
			speak("Lady Luck", "Best not to ask questions I suppose", "sly");
			speak("Lady Luck", "What would you like to wish for?", "sly");
			announcer.show("idle");
			speak(player, "For the world to stop falling apart");
			announcer.show("talking");
			speak("Lady Luck", "There are things even I can't do");
			announcer.show("idle");
			speak(player, "Hmmm then I suppose new technology");
			announcer.show("talking");
			speak("Lady Luck", "Sounds good, Xbox 4000 or whatever|should be out next fall");
			announcer.show("idle");
		} else if (player == "Ghost of Future" && episodenum == 1) {
			speak("Lady Luck", "Wait what's your name?", "normal");
			announcer.show("idle");
			speak(player, "Ghost of Christmas Future");
			announcer.show("talking");
			speak("Lady Luck", "Interesting");
			speak("Lady Luck", "Best not to ask questions I suppose", "sly");
			speak("Lady Luck", "What would you like to wish for?", "sly");
			announcer.show("idle");
			speak(player, "A time machine");
			announcer.show("talking");
			speak("Lady Luck", "Isn't your attack time travel");
			announcer.show("idle");
			speak(player, "Oh true true! Hmmm a new spaceship then!");
			announcer.show("talking");
			speak("Lady Luck", "Let me hit up Elon Musk This'll take a few seconds");
			announcer.show("idle");
			wait(10);
			announcer.show("talking");
			speak("Lady Luck", "Elon hey! Got a new space ship I could borrow?");
			announcer.show("idle");
			wait(3);
			announcer.show("talking");
			speak("Lady Luck", "Mhmm yea ok bye|see ya later yeppers alrighty buh bye");
			speak("Lady Luck", "It'll take 5 days to get here");
			announcer.show("idle");
		} else {
			speak(aname, "You've won, but I don't recognize who you are.", "worried");
			announcer.show("idle");
		}
		play("stopallmusic");
		endingcredits();
		return;
    }
} else if (player == "Lady Luck") {
    speak("Mariah Carey", "Oof, better luck next time!");
	announcer.show("idle");
	speak("Lady Luck", "There won't be a next time. I'm turning back.");
	announcer.show("talking");
	speak("Mariah Carey", "Oh no you're not. You're going to be a dice until you win the wheel.");
	announcer.show("idle");
	speak("Lady Luck", "What?!");
	play("stopallmusic");
	endingcredits();
	return;
} else {
    var secondlinevoice = false;
    for(message in variables.messages_afterspin) {
      var mood = "normal";
        if(!secondlinevoice){
        secondlinevoice = true;
        speak(aname, message.text, "normal");
      }else{
        speak(aname, message.text);
      }
    }
    announcer.show("idle");
    play("stopallmusic");
    endingcredits();
    return;
}

gamecompletefromcutscene();
